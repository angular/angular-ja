# サービスと依存性注入のイントロダクション

*サービス*は、アプリが必要とするあらゆる値、関数、機能を含む幅広いカテゴリです。
サービスは通常、目的が明確な小規模のクラスです。
特定の作業を行い、適切に処理するべきです。

Angular はサービスとコンポーネントを区別してモジュール性と再利用性を高めます。
コンポーネントのビュー関連の機能を他の種類の処理と分離することで、
コンポーネントクラスをリーンで効率的にすることができます。

理想的なのは、コンポーネントの仕事がユーザーエクスペリエンスとそれ以上のものを可能にするものであることです。
コンポーネントは、(テンプレートによってレンダリングされた)ビューと
(しばしばモデルの概念を含む)アプリケーションロジックを仲介するために、
データバインディングのプロパティとメソッドを提示する必要があります。

コンポーネントはサーバからデータを取得したり、ユーザーの入力を検証したり、
コンソールに直接ログするなど、特定のタスクをサービスに委任することができます。
このような処理のタスクを*注入可能なサービスクラス*で定義することにより、これらのタスクを任意のコンポーネントで
使用できるようにします。
さまざまな状況に応じて同じ種類のサービスの異なるプロバイダを注入することで、
アプリの適応性を高めることもできます。

Angularはこれらの原則を*強制*しません。Angularはアプリケーションロジックをサービスに組み込むことを容易にし、
*依存性注入*でコンポーネントからこれらのサービスを利用できるようにすることで、
これらの原則に*倣う*のに役立ちます。

## サービスの例

次に、ブラウザコンソールにログを記録するサービスクラスの例を示します。

<code-example path="architecture/src/app/logger.service.ts" linenums="false" title="src/app/logger.service.ts (class)" region="class"></code-example>

サービスは他のサービスに依存することがあります。たとえば、 `Logger` サービスに依存する `HeroService` と、 `BackendService` を使ってヒーローを取得します。そのサービスは、サーバーからヒーローを非同期的に取り出すための  `HttpClient` サービスに依存するかもしれません。

<code-example path="architecture/src/app/hero.service.ts" linenums="false" title="src/app/hero.service.ts (class)" region="class"></code-example>

## 依存性注入 (DI)

<img src="generated/images/guide/architecture/dependency-injection.png" alt="サービス" class="left">

DI は Angular フレームワークとつながり、必要なサービスやその他のものを新しいコンポーネントに提供するためにあらゆる場所で使用されます。
コンポーネントはサービスを消費します。つまり、サービスをコンポーネントに*注入*して、コンポーネントにそのサービスクラスへのアクセスを与えることができます。

クラスをサービスとして Angular で定義するには、  `@Injectable()` デコレータを使用して Angular が*依存関係*としてコンポーネントにそれを挿入できるようにするメタデータを提供します。
同様に、コンポーネントや他のクラス(別のサービス、パイプ、NgModuleなど)が依存関係を*持っている*ことを示すには、 `@Injectable()` デコレータを使用します。

* *インジェクタ* は主なメカニズムです。Angular はブートストラップ処理中にアプリケーション全体のインジェクタを作成し、必要に応じて追加のインジェクタを作成します。インジェクタを作成する必要はありません。

* インジェクタは依存関係を作成し、可能であれば再利用する依存関係インスタンスの*コンテナ*を保持します。

* *プロバイダ* は、インジェクタに依存性を取得または作成する方法を伝えるオブジェクトです。

あなたのアプリで必要な依存関係がある場合は、アプリのインジェクタにプロバイダを登録し、
インジェクタはプロバイダを使用して新しいインスタンスを作成できます。
サービスの場合、プロバイダーは通常、サービスクラスそのものです。

<div class="alert is-helpful">

依存関係はサービスである必要はありません。たとえば、関数や値などです。

</div>

Angular は、コンポーネントクラスの新しいインスタンスを作成すると、コンストラクタのパラメータタイプを調べることによってコンポーネントが必要とするサービスやその他の依存関係を判断します。たとえば、`HeroListComponent` のコンストラクタには　`HeroService` が必要です。

<code-example path="architecture/src/app/hero-list.component.ts" linenums="false" title="src/app/hero-list.component.ts (constructor)" region="ctor"></code-example>

Angular はコンポーネントがサービスに依存していることを検出すると、インジェクタにそのサービスの既存のインスタンスがあるかどうかをまずチェックします。要求されたサービスインスタンスがまだ存在しない場合、インジェクタは登録されたプロバイダを使用してインジェクタを作成し、サービスを Angular に返す前にインジェクタに追加します。

要求されたサービスがすべて解決されて返されると、Angular はそれらのサービスを引数としてコンポーネントのコンストラクタを呼び出すことができます。

`HeroService`注入のプロセスは、このようになります。

<figure>
  <img src="generated/images/guide/architecture/injector-injects.png" alt="サービス" class="left">
</figure>

### サービスの提供

あなたは、使用しようとしているサービスの*プロバイダ*を少なくとも1つ登録する必要があります。
プロバイダは、サービス自体のメタデータの一部となり、そのサービスをどこからでも利用できるようにするか、
プロバイダを特定のモジュールまたはコンポーネントに登録することができます。
プロバイダはサービスのメタデータ(`@Injectable()` デコレータ内) または
`@NgModule()` や `@Component()` メタデータにプロバイダを登録します

* デフォルトでは Angular CLI コマンド `ng generate service` はプロバイダのメタデータを `@Injectable()` デコレータに含めることによってプロバイダをルートインジェクタに登録します。このチュートリアルでは、このメソッドを使用して HeroService クラス定義のプロバイダを登録します。

   ``` js
   @Injectable({
    providedIn: 'root',
   })
   ``` 

   ルートレベルでサービスを提供すると、Angularは `HeroService` の共有インスタンスを1つ作成し、
   それを求めるクラスに注入します。
   `@Injectable()` メタデータにプロバイダを登録することで、Angular はアプリを最適化することもできます。
   コンパイルされたアプリケーションが使用されていない場合は、そのサービスをコンパイル済みのアプリケーションから削除します。

* プロバイダを[特定の NgModule](guide/architecture-modules) に登録すると、そのNgModule内のすべてのコンポーネントで同じサービスのインスタンスを使用できます。このレベルで登録するには、`@NgModule()` デコレータの `providers` プロパティを使用します。

   ```js
   @NgModule({
     providers: [
     BackendService,
     Logger
    ],
    ...
   })
   ``` 

* コンポーネントレベルでプロバイダーを登録すると、そのコンポーネントの新しいインスタンスごとに
新しいサービスインスタンスが取得されます。
コンポーネントレベルで `@Component()` メタデータの `providers` プロパティにサービスプロバイダを登録します。

   <code-example path="architecture/src/app/hero-list.component.ts" linenums="false" title="src/app/hero-list.component.ts (component providers)" region="providers"></code-example>

詳細は、[依存性注入](guide/dependency-injection)セクションを参照してください.
